# Project Agents.md Guide for OpenAI Codex

This Agents.md file provides comprehensive guidance for OpenAI Codex and other AI agents working with this codebase.

## Project Structure for OpenAI Codex Navigation

- `/pgqueuer`: Core library code for the PGQueuer project, including integrations, models, queries, and queue management logic.
- `/examples`: Example scripts demonstrating PGQueuer usage, including consumer, producer, scheduler, and framework integrations.
- `/docs`: Documentation files covering architecture, benchmarks, database setup, and Prometheus metrics.
- `/test`: Test files for unit tests, integration tests, and other test cases.
- `/tools`: Utility scripts for benchmarking and monitoring.

## Pre-Setup Instructions for PostgreSQL

### Option 1: Using Docker Compose

To set up a PostgreSQL instance for development and testing with Docker Compose, follow these steps:

1. Ensure Docker and Docker Compose are installed on your system.
2. Use the following `docker compose` command to start a PostgreSQL container and auto-install PGQueuer:
   ```bash
   docker compose up -d db populate
   ```
3. Verify that the PostgreSQL container is running:
   ```bash
   docker ps
   ```
4. Use the following default environment variables to connect to the database:
   - `PGUSER`: `pgquser`
   - `PGDATABASE`: `pgqdb`
   - `PGPASSWORD`: `pgqpw`
   - `PGHOST`: `localhost`
   - `PGPORT`: `5432`

These settings are pre-configured in the `docker-compose.yml` file.

### Option 2: Manual PostgreSQL Installation

If Docker Compose is not available, you can manually install and configure PostgreSQL:

1. Install PostgreSQL:
   - On macOS: Use Homebrew:
     ```bash
     brew install postgresql
     ```
   - On Ubuntu/Debian:
     ```bash
     sudo apt update
     sudo apt install postgresql postgresql-contrib
     ```

2. Start the PostgreSQL service:
   - On macOS:
     ```bash
     brew services start postgresql
     ```
   - On Ubuntu/Debian:
     ```bash
     sudo service postgresql start
     ```

3. Create a new PostgreSQL user and database:
   ```bash
   psql -U postgres
   ```
   Then run the following commands inside the PostgreSQL shell:
   ```sql
   CREATE USER pgquser WITH PASSWORD 'pgqpw';
   CREATE DATABASE pgqdb OWNER pgquser;
   ```

4. Update the PostgreSQL configuration to allow local connections:
   - Edit the `pg_hba.conf` file (location varies by system, e.g., `/etc/postgresql/<version>/main/pg_hba.conf` on Ubuntu).
   - Add or modify the following line:
     ```
     host    all             all             127.0.0.1/32            md5
     ```

5. Restart PostgreSQL to apply changes:
   ```bash
   sudo service postgresql restart
   ```

6. Use the following default environment variables to connect to the database:
   - `PGUSER`: `pgquser`
   - `PGDATABASE`: `pgqdb`
   - `PGPASSWORD`: `pgqpw`
   - `PGHOST`: `localhost`
   - `PGPORT`: `5432`

7. Install the PGQueuer schema:
   ```bash
   pgq install
   ```

## Coding Conventions for OpenAI Codex

### General Conventions for Agents.md Implementation

- Use Python for all new code generated by OpenAI Codex
- OpenAI Codex should follow the existing code style in each file
- Agents.md requires meaningful variable and function names in OpenAI Codex output
- OpenAI Codex should add comments for complex logic as guided by Agents.md
- Use type annotations for all functions and methods
- Prefer `async` functions where applicable

## Testing Requirements for OpenAI Codex

OpenAI Codex should run tests with the following commands, ensuring the required environment variables are set inline:

```bash
# Run all tests with OpenAI Codex
PGUSER=pgquser PGDATABASE=pgqdb PGPASSWORD=pgqpw PGHOST=localhost PGPORT=5432 uv run pytest

# Run a specific test file with OpenAI Codex
PGUSER=pgquser PGDATABASE=pgqdb PGPASSWORD=pgqpw PGHOST=localhost PGPORT=5432 uv run pytest path/to/test-file.py
```

## Pull Request Guidelines for OpenAI Codex

When OpenAI Codex helps create a PR, please ensure it:

1. Includes a clear description of the changes as guided by Agents.md
2. References any related issues that OpenAI Codex is addressing
3. Ensures all tests pass for code generated by OpenAI Codex
4. Includes screenshots for UI changes implemented with OpenAI Codex
5. Keeps PRs focused on a single concern as specified in Agents.md

## Programmatic Checks for OpenAI Codex

Before submitting changes generated by OpenAI Codex, run the following checks, ensuring the required environment variables are set inline:

```bash
# Lint check for OpenAI Codex code
PGUSER=pgquser PGDATABASE=pgqdb PGPASSWORD=pgqpw PGHOST=localhost PGPORT=5432 uv run ruff check .

# Type check for OpenAI Codex Python
PGUSER=pgquser PGDATABASE=pgqdb PGPASSWORD=pgqpw PGHOST=localhost PGPORT=5432 uv run mypy .

# Build check for OpenAI Codex implementations
PGUSER=pgquser PGDATABASE=pgqdb PGPASSWORD=pgqpw PGHOST=localhost PGPORT=5432 uv sync --all-extras --frozen
PGUSER=pgquser PGDATABASE=pgqdb PGPASSWORD=pgqpw PGHOST=localhost PGPORT=5432 uv run pytest -v
```

All checks must pass before OpenAI Codex generated code can be merged. Agents.md helps ensure OpenAI Codex follows these requirements.
